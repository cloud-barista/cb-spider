<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>VPC/Subnet Management</title>
<style>
    body {
        font-family: Arial, sans-serif;
        font-size: 12px;
    }
    .header-container {
        display: flex;
        align-items: flex-end;
    }
    .header-container img {
        margin-right: 10px;
        height: 28px;
    }
    .header-container h1 {
        font-size: 16px;
        margin: 0;
    }
    h2 {
        font-size: 16px;
        margin: 10px 0;
    }
    h3 {
        font-size: 14px;
        margin: 10px 0;
        margin-left: 1cm;
    }
    table {
        width: 100%;
        border-collapse: collapse;
        table-layout: fixed;
        margin-bottom: 0;
    }
    th, td {
        border: 1px solid black;
        padding: 6px;
        position: relative;
    }
    th {
        background-color: #f2f2f2;
        font-size: 14px;
        text-align: center;
    }
    td {
        text-align: left;
    }
    .column-num {
        width: 5%;
        text-align: center;
    }
    .center-align {
        text-align: center;
    }
    .overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0,0,0,0.5);
        justify-content: center;
        align-items: center;
    }
    .overlay-content {
        background-color: white;
        padding: 20px;
        border-radius: 5px;
        text-align: left;
        font-family: Arial, sans-serif;
        font-size: 12px;
    }
    .tag-overlay {
        display: none;
        position: absolute;
        background-color: white;
        border: 1px solid black;
        padding: 20px;
        z-index: 1001;
        font-family: Arial, sans-serif;
        font-size: 14px;
        max-width: 300px;
        word-wrap: break-word;
    }
    .tag-overlay .close-btn {
        position: absolute;
        top: -10px;
        right: -5px;
        background: none;
        border: none;
        font-size: 16px;
        cursor: pointer;
    }
    .tag-overlay .button-group {
        display: flex;
        justify-content: space-between;
        margin-top: 20px;
    }
    .fixed-header {
        position: fixed;
        top: 0;
        width: 97%;
        background-color: white;
        z-index: 1000;
        display: flex;
        justify-content: space-between;
        padding: 10px 20px;
        align-items: center;
        box-shadow: 0 4px 6px -6px #222;
    }
    .fixed-action-buttons {
        display: flex;
        align-items: center;
    }
    .fixed-action-buttons button {
        margin-left: 10px;
    }
    .add-button {
        font-size: 14px;
        font-weight: bold;
        margin-left: 1px;
        margin-right: 5px;
        margin-bottom: 10px;
    }
    .mock-add-button {
        margin-right: 1px;
    }
    .content {
        margin-top: 70px;
    }
    .checkbox-cell {
        width: 5%;
        text-align: center;
    }
    .highlight {
        background-color: #fffab6
    }
    .highlight-pastel-blue {
        color: #4A90E2;
        font-weight: bold;
    }
    .select-button {
        margin-left: 10px;
        font-size: 10px;
        padding: 3px 5px;
    }
    .disabled-input {
        background-color: #f0f0f0;
        color: #a0a0a0;
        border: 1px solid #d0d0d0;
    }
    .select-list-item {
        color: #0645AD;
        text-decoration: underline;
        cursor: pointer;
    }
    .select-list-item:hover {
        color: #0B0080;
    }
    .form-group {
        display: flex;
        align-items: center;
        margin-bottom: 10px;
    }
    .form-group label {
        flex: 1;
        text-align: right;
        margin-right: 10px;
    }
    .form-group input, .form-group textarea {
        flex: 2;
    }
    .form-group button {
        margin-left: 10px;
    }
    .vpc-count {
        width: 50px;
    }
    .form-group .tag-inputs {
        display: flex;
        flex: 2;
        margin-left: 10px;
    }
    .form-group .tag-inputs input {
        flex: 1;
        margin-right: 5px;
    }
    .tag-input-group {
        display: flex;
        align-items: center;
        flex: 2;
    }
    .tag-input-group input {
        width: 100px;
        flex: 0.5;
        margin-right: 5px;
    }
    .add-tag-input-group input {
        width: 100px;
        flex: 0.5;
        margin-right: 5px;
    }
    .tag-input-group button {
        margin-left: 5px;
    }
    .error-message {
        background-color: #F8D7DA;
        color: #721C24;
        padding: 20px;
        border-radius: 5px;
        font-size: 16px;
        margin-bottom: 20px;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 2000;
        text-align: center;
    }
    .error-message button {
        display: block;
        margin: 20px auto 0;
    }
    .tag-container {
        display: inline-block;
        background-color: #e1e1e1;
        border-radius: 3px;
        padding: 2px 5px;
        margin: 2px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        cursor: pointer;
        max-width: calc(100% - 2ch);
    }
    .tag-container:hover {
        background-color: #c1e1c1;
    }
    .add-btn-container {
        margin-top: 5px;
    }
    .add-btn-container .add-btn {
        background-color: transparent;
        font-size: 14px;
        border: none;
        color: blue;
        text-decoration: underline;
        cursor: pointer;
    }

    .add-tag-overlay-content {
        background-color: white;
        padding: 20px;
        border-radius: 5px;
        text-align: left;
        font-family: Arial, sans-serif;
        font-size: 14px;
        max-width: 300px;
        word-wrap: break-word;
        position: relative;
    }
    
    .add-tag-overlay-content .tag-overlay-input-group {
        display: flex;
        align-items: center;
        margin-bottom: 10px;
    }

    .add-tag-overlay-content .tag-overlay-input-group label {
        flex: 1;
        text-align: right;
        margin-right: 10px;
    }

    .add-tag-overlay-content .tag-overlay-input-group input {
        flex: 2;
    }

    .add-tag-overlay-content .tag-overlay-button-group {
        display: flex;
        justify-content: space-between;
        margin-top: 20px;
    }
    .vpc-name {
        width: 10%;
    }
    .vpc-cidr {
        width: 10%;
    }
    .subnet-info {
        width: 40%;
    }
    .tags {
        width: 15%;
    }
    .misc {
        width: 15%;
    }
    .overlay-dark-background {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.7);
        z-index: 1999;
        display: none;
    }
    .misc-overlay {
        display: none;
        position: fixed;
        top: 50%;
        left: 50%;
        width: 50%;
        height: 50%;
        transform: translate(-50%, -50%);
        background-color: white;
        border: 1px solid black;
        padding: 20px;
        z-index: 2000;
        overflow-y: auto;
        user-select: text;
    }
    .misc-overlay .close-btn {
        position: absolute;
        top: 10px;
        right: 10px;
        background: none;
        border: none;
        font-size: 16px;
        cursor: pointer;
    }
    .misc-overlay-content {
        font-size: 14px;
        width: 700px;
        position: relative;
        padding-top: 30px;
        line-height: 1.5;
        white-space: pre-wrap;
    }
    .misc-content {
        max-height: 2.5em;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }
    .more-btn {
        display: none;
        background-color: transparent;
        border: none;
        color: blue;
        text-decoration: underline;
        cursor: pointer;
    }
    .misc-cell {
        position: relative;
    }
    .misc-cell .more-btn {
        position: absolute;
        right: 5px;
        bottom: 5px;
    }
    .inner-table th {
        background-color: #f9f9f9;
        font-size: 12px;
        padding: 2px;
        text-align: center;
    }
    .inner-table td {
        font-size: 12px;
        padding: 2px;
        text-align: center;
    }
    .inner-table .tags-cell {
        text-align: left;
        width: auto;
    }
    .inner-table .actions-cell {
        width: 60px;
        white-space: nowrap;
    }
    .inner-table .tags-cell div {
        display: inline-block;
        padding: 2px 5px;
        max-width: calc(100% - 2ch);
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    .inner-table button.delete-btn {
        width: auto;
        font-size: 12px;
        font-weight: bold;
        white-space: nowrap;
    }
    .inner-table button.add-btn {
        width: auto;
        font-size: 12px;
        font-weight: bold;
        white-space: nowrap;
    }
    .inner-table button.plus-btn {
        background-color: transparent;
        font-size: 14px;
        font-weight: bold;
        border: none;
        color: blue;
        text-decoration: underline;
        cursor: pointer;
    }
    .inner-table .name-column {
        width: 28%;
    }
    .inner-table .cidr-column {
        width: 16%;
    }
    .inner-table .zone-column {
        width: 16%;
    }
    .inner-table .tags-column {
        width: 25%;
    }
    button.add-btn {
        width: 20px;
        font-size: 12px;
        font-weight: bold;
        white-space: nowrap;
    }
    #searchInput {
        width: 190px;
        font-family: Arial, sans-serif;
        padding-right: 2.5cm;
    }
    #clearSearch {
        position: absolute;
        right: 0.1cm;
        top: 50%;
        transform: translateY(-50%);
        border: none;
        background-color: transparent;
        cursor: pointer;
        font-family: Arial, sans-serif;
    }
    .searchContainer {
        position: relative;
        display: flex;
        align-items: center;
        padding-left: 0.5cm;
    }
    .searchContainer button {
        position: absolute;
        right: 0.5cm;
        top: 50%;
        transform: translateY(-50%);
        border: none;
        background-color: transparent;
        cursor: pointer;
        font-family: Arial, sans-serif;
    }
    .tag-overlay-content {
        position: relative;
        padding: 20px;
        border-radius: 5px;
        background-color: white;
        text-align: left;
        font-family: Arial, sans-serif;
        font-size: 12px;
    }
    .tag-overlay-input-group {
        display: flex;
        align-items: center;
        margin-bottom: 10px;
    }
    .tag-overlay-input-group label {
        flex: 1;
        text-align: right;
        margin-right: 10px;
    }
    .tag-overlay-input-group input {
        flex: 2;
    }
    .tag-overlay-button-group {
        display: flex;
        justify-content: space-between;
        margin-top: 20px;
    }
    .header-with-progress {
        display: flex;
        align-items: center;
        margin-bottom: 0px;
    }
    .progress-bar-container {
        width: 600px;
        margin-left: 10px;
        margin-bottom: 10px;
        height: 22px;
        background-color: #f0f5ff;
        border-radius: 4px;
        overflow: hidden;
        display: none;
        position: relative;
        z-index: 20;
    }

    .progress-bar {
        width: 0;
        height: 100%;
        background-color: #cce6ff;
        border-radius: 4px;
        transition: width 3s ease;
    }
    #timeDisplay {
        position: absolute;
        top: 50%;
        right: 10px;
        transform: translateY(-50%);
        font-size: 14px;
        color: #333;
        z-index: 30;
    }

    .vpc-name-cell {
        text-align: left;
        font-size: 13px;
        font-weight: bold;
    }
    .vpc-name-cell .desc-system-id {
        display: block;
        font-size: 12px;
        font-weight: normal;
        color: #666;
    }

    .vpc-name {
        width: 13%;
    }
    .vpc-cidr {
        width: 7%;
    }

    .desc-system-id {
        display: block;
        font-size: 12px;
        font-weight: normal;
        color: #666;
        max-width: 200px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        cursor: pointer;
    }

    .system-id-overlay {
        display: none;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 50%;
        max-width: 600px;
        background-color: white;
        border: 1px solid black;
        padding: 20px;
        z-index: 2000;
        border-radius: 5px;
    }

    .system-id-overlay-content {
        position: relative;
        font-family: Arial, sans-serif;
        font-size: 14px;
        word-wrap: break-word;
    }

    .system-id-overlay .close-btn {
        position: absolute;
        top: -15px;
        right: -5px;
        background: none;
        border: none;
        font-size: 16px;
        cursor: pointer;
    }

    .copy-btn {
        background: none;
        border: none;
        font-size: 16px;
        cursor: pointer;
        margin-left: 10px;
    }

</style>
</head>
<body>
    <div class="fixed-header">
        <div class="header-container">
            <img src="/spider/adminweb/images/left-menu/vpc.png" alt="VPC Icon">
            <h1>VPC/Subnet Management</h1>
            <div class="searchContainer">
                <input type="text" id="searchInput" onkeyup="searchKeyword()" placeholder="Search Keyword...">
                <button id="clearSearch" onclick="clearSearchInput()">X</button>
            </div>
        </div>        
        <div class="fixed-action-buttons">
            <input type="checkbox" onclick="toggleSelectAll(this)">
            <button onclick="deleteSelectedVPCs()">Delete</button>
        </div>
    </div>
    
    <div class="content">
        <div class="header-with-progress">
            <button class="add-button" onclick="showOverlay()">+</button>
            <div id="mockButtonsContainer" style="display: flex; align-items: center;"></div>
            <div class="progress-bar-container" id="progressBarContainer">
                <div class="progress-bar" id="progressBar"></div>
                <span id="timeDisplay"></span>
            </div>                       
        </div>
        <table id="vpc-table">
            <tr>
                <th class="column-num">#</th>
                <th class="vpc-name center-align">Name</th>
                <th class="vpc-cidr center-align">CIDR</th>
                <th class="subnet-info">Subnet Info</th>
                <th class="tags center-align">Tags</th>
                <th class="misc center-align">Misc</th>
                <th class="checkbox-cell center-align"><input type="checkbox" onclick="toggleSelectAll(this)"></th>
            </tr>
            {{range $index, $vpc := .VPCs}}
            {{ $vpcNameId := $vpc.IId.NameId }}
            <tr>
                <td class="column-num">{{$index | inc}}</td>
                <td class="vpc-name-cell">{{$vpc.IId.NameId}}
                    <span class="desc-system-id" onclick="showSystemIdOverlay('{{$vpc.IId.SystemId}}')">&nbsp;• {{$vpc.IId.SystemId}}</span></td>
                    <td class="vpc-cidr center-align">{{$vpc.IPv4_CIDR}}</td>
                    <td class="subnet-info">
                        {{if $vpc.IPv4_CIDR}}
                            <table class="inner-table">
                                <tr>
                                    <th class="name-column">Name</th>
                                    <th class="cidr-column">CIDR</th>
                                    <th class="zone-column">Zone</th>
                                    <th class="tags-column">Tags</th>
                                    <th class="actions-cell"><button class="add-btn" onclick="showSubnetOverlay('{{$vpcNameId}}')">add</button></th>
                                </tr>
                                {{range $subnetIndex, $subnet := $vpc.SubnetInfoList}}
                                {{ $subnetNameId := $subnet.IId.NameId }}
                                <tr>
                                    <td class="vpc-name-cell" style="text-align: left;">{{$subnet.IId.NameId}}
                                        <span class="desc-system-id" onclick="showSystemIdOverlay('{{$subnet.IId.SystemId}}')">&nbsp;• {{$subnet.IId.SystemId}}</span>
                                    </td>
                                    <td>{{$subnet.IPv4_CIDR}}</td>
                                    <td>{{$subnet.Zone}}</td>
                                    <td class="tags-cell">
                                        {{range $tag := $subnet.TagList}}
                                        <div class="tag-container" onclick="showTagOverlay(event, '{{$tag.Key}}: {{$tag.Value}}', 'SUBNET', '{{$subnetNameId}}')">{{$tag.Key}}: {{$tag.Value}}</div>
                                        {{end}}
                                        <div class="add-btn-container">
                                            <button class="plus-btn" onclick="showAddSubnetTagOverlay('{{$vpcNameId}}', '{{$subnetNameId}}')">+</button>
                                        </div>
                                    </td>
                                    <td class="actions-cell">
                                        <button class="delete-btn" onclick="deleteSubnet('{{$vpcNameId}}', '{{$subnet.IId.NameId}}')">del</button>
                                    </td>
                                </tr>
                                {{end}}
                            </table>
                        {{end}}
                </td>
                <td class="tags">
                    {{if $vpc.IPv4_CIDR}}
                        {{range $tag := $vpc.TagList}}
                        <div class="tag-container" onclick="showTagOverlay(event, '{{$tag.Key}}: {{$tag.Value}}', 'VPC', '{{$vpcNameId}}')">{{$tag.Key}}: {{$tag.Value}}</div>
                        {{end}}
                        <div class="add-btn-container">
                            <button class="add-btn" onclick="showAddTagOverlay('{{$vpcNameId}}')">+</button>
                        </div>
                    {{end}}
                </td>                
                <td class="misc center-align misc-cell">
                    <div class="misc-content">{{range $kv := $vpc.KeyValueList}}{{$kv.Key}} : {{$kv.Value}}<br>{{end}}
                    </div>
                    <button class="more-btn" onclick="showMiscOverlay(this)">more...</button>
                </td>
                <td class="checkbox-cell center-align">
                    <input type="checkbox" name="deleteCheckbox" value="{{$vpc.IId.NameId}}">
                </td>
            </tr>
            {{end}}
            {{if not .VPCs}}
            <tr>
                <td colspan="7" class="center-align">No VPCs found for this connection.</td>
            </tr>
            {{end}}
        </table>
    </div>

    <div id="overlay" class="overlay">
        <div class="overlay-content">
            <h2>Add New VPC/Subnet</h2>
            <form id="addVPCForm" onsubmit="event.preventDefault(); postVPC();">
                <input type="hidden" id="connConfig" value="{{.ConnectionConfig}}">
                <div id="vpc-info-group">
                    <h3>VPC Info:</h3>
                    <div class="form-group">
                        <label for="vpcName">Name:</label>
                        <input type="text" id="vpcName" name="vpcName" required>
                    </div>
                    <div class="form-group">
                        <label for="vpcCIDR">CIDR:</label>
                        <input type="text" id="vpcCIDR" name="vpcCIDR" required>
                    </div>
                    <div class="form-group" style="padding-left: 145px;">
                        <label for="vpcTags">Tags:</label>
                        <div id="vpc-tag-container"></div>
                        <button type="button" onclick="addVPCTagField()">+</button>
                    </div>
                </div>
                <div id="subnet-info-group" style="margin-top: 20px;">
                    <h3>Subnet Info:</h3>
                    <div class="form-group">
                        <label for="subnetName">Name:</label>
                        <input type="text" id="subnetName" name="subnetName" required>
                    </div>
                    <div class="form-group">
                        <label for="subnetCIDR">CIDR:</label>
                        <input type="text" id="subnetCIDR" name="subnetCIDR" required>
                    </div>
                    <div class="form-group">
                        <label for="subnetZone">Zone:</label>
                        <select id="subnetZone" name="subnetZone" required></select>
                    </div>
                    <div class="form-group" style="padding-left: 145px;">
                        <label for="subnetTags">Tags:</label>
                        <div id="subnet-tag-container"></div>
                        <button type="button" onclick="addSubnetTagField()">+</button>
                    </div>
                </div>
                <div style="display: flex; justify-content: center; align-items: center; margin-top: 20px;">
                    <label for="vpcCount" style="margin-right: 5px;margin-left: 40px;">#:</label>
                    <input type="number" id="vpcCount" name="vpcCount" class="vpc-count" value="1" min="1" max="10" style="width: 50px; margin-right: 10px;">
                    <button type="submit">Add VPC/Subnet</button>
                    <button type="button" onclick="hideOverlay()" style="margin-left: 10px;">Cancel</button>
                </div>
                
            </form>
        </div>
    </div>

    <div id="subnet-overlay" class="overlay">
        <div class="overlay-content">
            <h2>Add New Subnet</h2>
            <form id="addSubnetForm" onsubmit="event.preventDefault(); addSubnet();">
                <input type="hidden" id="subnetVPCName">
                <input type="hidden" id="connConfig" value="{{.ConnectionConfig}}">
                <div class="form-group">
                    <label for="subnetVPCNameDisplay">VPC Name:</label>
                    <input type="text" id="subnetVPCNameDisplay" name="subnetVPCNameDisplay" style="background-color:#d0d0d0" readonly>
                </div>
                <div class="form-group">
                    <label for="addSubnetName">Name:</label>
                    <input type="text" id="addSubnetName" name="addSubnetName" required>
                </div>
                <div class="form-group">
                    <label for="addSubnetCIDR">CIDR:</label>
                    <input type="text" id="addSubnetCIDR" name="addSubnetCIDR" required>
                </div>
                <div class="form-group">
                    <label for="addSubnetZone">Zone:</label>
                    <select id="addSubnetZone" name="addSubnetZone" required></select>
                </div>
                <div class="form-group" style="padding-left: 20px;">
                    <label for="addSubnetTags">Tags:</label>
                    <div id="add-subnet-tag-container">
                    </div>
                    <button type="button" onclick="addAddSubnetTagField()">+</button>
                </div>
                <div class="form-group" style="display: flex; justify-content: center; align-items: center; margin-top: 20px;">
                    <button type="submit">Add Subnet</button>
                    <button type="button" onclick="hideSubnetOverlay()">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <div id="tag-overlay" class="tag-overlay">
        <div class="tag-overlay-content"></div>
    </div>

    <div id="add-tag-overlay" class="overlay">
        <div class="add-tag-overlay-content overlay-content"></div>
    </div>

    <div id="add-subnet-tag-overlay" class="overlay">
        <div class="add-subnet-tag-overlay-content overlay-content"></div>
    </div>

    <input type="hidden" id="connConfig" value="{{.ConnectionConfig}}">

    <div id="system-id-overlay" class="system-id-overlay">
        <div class="system-id-overlay-content">
            <button class="close-btn" onclick="closeSystemIdOverlay()">x</button>
            <h2>System ID (Managed by CSP)</h2>
            <p id="fullSystemId"></p>
            <button class="copy-btn" onclick="copySystemId()">📋</button>
        </div>
    </div>
    
</body>

<script>
    let currentProvider = '';

    function showError(message, title) {
        const errorDiv = document.createElement('div');
        errorDiv.className = 'error-message';
        const formattedMessage = message.split('.').join('.<br>');
        errorDiv.innerHTML = `<p>${title}</p><p>${formattedMessage}</p><button onclick="closeError()">OK</button>`;
        document.body.appendChild(errorDiv);
        document.addEventListener('keydown', handleEscError);
    }

    function closeError() {
        const errorDiv = document.querySelector('.error-message');
        if (errorDiv) {
            errorDiv.remove();
            document.removeEventListener('keydown', handleEscError);
        }
    }

    function handleEscError(event) {
        if (event.key === "Escape") {
            closeError();
        }
    }

    function deleteVPC(vpcName) {
        const connConfig = document.getElementById('connConfig').value;
        const data = {
            ConnectionName: connConfig
        };

        fetchWithProgress(`/spider/vpc/${vpcName}`, {
            method: 'DELETE',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        })
        .then(response => {
            if (!response.ok) {
                return response.json().then(error => {
                    throw new Error(error.message);
                });
            }
            return response.json();
        })
        .then(data => {
            if (data.Result === "true") {
                location.reload();
            } else {
                showError("Failed to delete VPC: " + (data.Message || "Unknown error"), "VPC Name: " + vpcName);
            }
        })
        .catch(error => {
            showError("Error deleting VPC: " + error.message, "VPC Name: " + vpcName);
        });
    }

    function deleteSelectedVPCs() {
        const connConfig = document.getElementById('connConfig').value;
        const checkboxes = document.querySelectorAll('input[name="deleteCheckbox"]:checked');
        if (checkboxes.length === 0) {
            alert("Please select VPCs to delete.");
            return;
        }

        if (!confirm("Are you sure you want to delete the selected VPCs?")) {
            return;
        }

        const deletePromises = Array.from(checkboxes).map(checkbox => {
            const vpcName = checkbox.value;
            const data = {
                ConnectionName: connConfig
            };

            return fetchWithProgress(`/spider/vpc/${vpcName}`, {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            }).then(response => {
                if (!response.ok) {
                    return response.json().then(error => {
                        throw new Error(error.message);
                    });
                }
                return response.json();
            });
        });

        Promise.all(deletePromises)
            .then(() => location.reload())
            .catch(error => {
                alert("Error deleting VPCs: " + error.message);
            });
    }

    function toggleSelectAll(source) {
        const checkboxes = document.querySelectorAll('input[name="deleteCheckbox"]');
        for (const checkbox of checkboxes) {
            checkbox.checked = source.checked;
        }
    }

    function validateForm() {
        const vpcName = document.getElementById('vpcName').value;
        const vpcCIDR = document.getElementById('vpcCIDR').value;
        const subnetName = document.getElementById('subnetName').value;
        const subnetCIDR = document.getElementById('subnetCIDR').value;
        const subnetZone = document.getElementById('subnetZone').value;
        const vpcCount = document.getElementById('vpcCount').value;

        if (!vpcName || !vpcCIDR || !subnetName || !subnetCIDR || !subnetZone || !vpcCount) {
            alert("Please fill in all the fields.");
            return false;
        }
        if (vpcCount < 1 || vpcCount > 10) {
            alert("Please enter a valid count between 1 and 10.");
            return false;
        }
        return true;
    }

    function postVPC() {
        if (!validateForm()) {
            return;
        }

        const vpcCount = parseInt(document.getElementById('vpcCount').value);
        if (vpcCount > 1) {
            if (!confirm(`Are you sure you want to create ${vpcCount} VPCs/Subnets?`)) {
                return;
            }
        }

        const connConfig = document.getElementById('connConfig').value;
        const vpcCIDR = document.getElementById('vpcCIDR').value;
        const subnetCIDR = document.getElementById('subnetCIDR').value;
        const subnetZone = document.getElementById('subnetZone').value;

        const vpcPromises = Array.from({ length: vpcCount }).map((_, index) => {
            const vpcName = vpcCount > 1 ? `${document.getElementById('vpcName').value}-${index + 1}` : document.getElementById('vpcName').value;
            const subnetName = vpcCount > 1 ? `${document.getElementById('subnetName').value}-${index + 1}` : document.getElementById('subnetName').value;
            const subnetInfo = [{
                Name: subnetName,
                IPv4_CIDR: subnetCIDR,
                Zone: subnetZone,
                TagList: Array.from(document.querySelectorAll('.subnet-tag-input')).map(tagInput => ({
                    Key: tagInput.querySelector('.subnet-tag-key').value,
                    Value: tagInput.querySelector('.subnet-tag-value').value
                }))
            }];

            const tags = Array.from(document.querySelectorAll('.vpc-tag-input')).map(tagInput => ({
                Key: tagInput.querySelector('.vpc-tag-key').value,
                Value: tagInput.querySelector('.vpc-tag-value').value
            }));

            const data = {
                ConnectionName: connConfig,
                ReqInfo: {
                    Name: vpcName,
                    IPv4_CIDR: vpcCIDR,
                    SubnetInfoList: subnetInfo,
                    TagList: tags
                }
            };

            return fetchWithProgress('/spider/vpc', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            }).then(response => {
                if (!response.ok) {
                    return response.json().then(error => {
                        throw new Error(error.message);
                    });
                }
                return response.json();
            });
        });


        Promise.all(vpcPromises)
            .then(() => {
                location.reload();
            })
            .catch(error => {
                showError("Error creating VPCs: " + error.message, "Multiple VPCs");
            });
    }

    function showOverlay() {
        const zoneSelect = document.getElementById('subnetZone');
        fetchZone(zoneSelect);
        document.getElementById('overlay').style.display = 'flex';
        document.addEventListener('keydown', handleEsc);
        clearFormFields();
    }

    function hideOverlay() {
        document.getElementById('overlay').style.display = 'none';
        document.removeEventListener('keydown', handleEsc);
        clearFormFields();
    }

    function handleEsc(event) {
        if (event.key === "Escape") {
            hideOverlay();
        }
    }

    function clearFormFields() {
        const region = '{{.RegionName}}';
        const zone = '{{.Zone}}';
        const vpcNameInput = document.getElementById('vpcName');
        const subnetNameInput = document.getElementById('subnetName');
        const zoneInput = document.getElementById('subnetZone');
        const connConfig = document.getElementById('connConfig').value;
        const vpcCIDRInput = document.getElementById('vpcCIDR');
        const subnetCIDRInput = document.getElementById('subnetCIDR');

        vpcNameInput.value = `${region}-vpc-${Math.random().toString(36).substring(2, 5)}`;
        vpcCIDRInput.value = '10.0.0.0/16';
        disableGCPCIDR(connConfig);
        zoneInput.value = zone;
        subnetNameInput.value = `${region}-${zone}-subnet-${Math.random().toString(36).substring(2, 5)}`;
        subnetCIDRInput.value = '10.0.1.0/24';

        document.querySelectorAll('.vpc-tag-input, .subnet-tag-input').forEach(tagInput => tagInput.remove());
    }

    function showSubnetOverlay(vpcName) {
        const region = '{{.RegionName}}';
        const zone = '{{.Zone}}';
        const zoneSelect = document.getElementById('addSubnetZone');
        
        fetchZone(zoneSelect);
        
        document.getElementById('subnetVPCName').value = vpcName;
        document.getElementById('subnetVPCNameDisplay').value = vpcName;
        document.getElementById('addSubnetName').value = `${region}-${zone}-subnet-${Math.random().toString(36).substring(2, 5)}`;
        document.getElementById('addSubnetCIDR').value = '10.0.2.0/24';

        document.getElementById('subnet-overlay').style.display = 'flex';
        document.addEventListener('keydown', handleEscSubnet);
        clearSubnetFormFields();
    }

    function hideSubnetOverlay() {
        document.getElementById('subnet-overlay').style.display = 'none';
        document.removeEventListener('keydown', handleEscSubnet);
        clearSubnetFormFields();
    }

    function handleEscSubnet(event) {
        if (event.key === "Escape") {
            hideSubnetOverlay();
        }
    }

    function clearSubnetFormFields() {
        document.querySelectorAll('.add-subnet-tag-input').forEach(tagInput => tagInput.remove());
    }

    function addSubnet() {
        const vpcName = document.getElementById('subnetVPCName').value;
        const connConfig = document.getElementById('connConfig').value;
        const subnetName = document.getElementById('addSubnetName').value;
        const subnetCIDR = document.getElementById('addSubnetCIDR').value;
        const subnetZone = document.getElementById('addSubnetZone').value;

        const data = {
            ConnectionName: connConfig,
            ReqInfo: {
                Name: subnetName,
                IPv4_CIDR: subnetCIDR,
                Zone: subnetZone,
                TagList: Array.from(document.querySelectorAll('.add-subnet-tag-input')).map(tagInput => ({
                    Key: tagInput.querySelector('.add-subnet-tag-key').value,
                    Value: tagInput.querySelector('.add-subnet-tag-value').value
                }))
            }
        };

        fetchWithProgress(`/spider/vpc/${vpcName}/subnet`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        })
        .then(response => {
            if (!response.ok) {
                return response.json().then(error => {
                    throw new Error(error.message);
                });
            }
            return response.json();
        })
        .then(data => {
            if (data) {
                location.reload();
            }
        })
        .catch(error => {
            showError("Error creating Subnet: " + error.message, "Subnet Name: " + subnetName);
        });
    }

    function deleteSubnet(vpcName, subnetName) {
        if (!confirm(`Are you sure you want to delete the subnet: ${subnetName}?`)) {
            return;
        }

        const connConfig = document.getElementById('connConfig').value;
        const data = {
            ConnectionName: connConfig
        };

        fetchWithProgress(`/spider/vpc/${vpcName}/subnet/${subnetName}`, {
            method: 'DELETE',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        })
        .then(response => {
            if (!response.ok) {
                return response.json().then(error => {
                    throw new Error(error.message);
                });
            }
            return response.json();
        })
        .then(data => {
            if (data.Result === "true") {
                location.reload();
            } else {
                showError("Failed to delete Subnet: " + (data.Message || "Unknown error"), "Subnet Name: " + subnetName);
            }
        })
        .catch(error => {
            showError("Error deleting Subnet: " + error.message, "Subnet Name: " + subnetName);
        });
    }

    function showTagOverlay(event, tag, resourceType, resourceName) {
        event.stopPropagation();
        const tagOverlay = document.getElementById('tag-overlay');
        const tagOverlayContent = document.querySelector('.tag-overlay-content');
        tagOverlayContent.innerHTML = `
            <button class="close-btn" onclick="closeTagOverlay()">x</button>
            <p>${tag}</p>
            <div class="button-group">
                <button onclick="deleteTag('${tag}', '${resourceType}', '${resourceName}')">Delete</button>
                <button onclick="closeTagOverlay()">Cancel</button>
            </div>
        `;
        tagOverlay.style.display = 'block';
        tagOverlay.style.top = `${event.clientY}px`;
        tagOverlay.style.left = `${event.clientX}px`;
        document.addEventListener('click', handleClickOutsideOverlay);
        document.addEventListener('keydown', handleEscTagOverlay);
    }

    function deleteTag(tag, resourceType, resourceName) {
        const connConfig = document.getElementById('connConfig').value;
        const [tagKey, tagValue] = tag.split(': ');

        const data = {
            ConnectionName: connConfig,
            ReqInfo: {
                ResourceType: resourceType.trim(),
                ResourceName: resourceName.trim()
            }
        };

        fetchWithProgress(`/spider/tag/${tagKey.trim()}`, {
            method: 'DELETE',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        })
        .then(response => {
            if (!response.ok) {
                return response.json().then(error => {
                    throw new Error(error.message);
                });
            }
            return response.json();
        })
        .then(data => {
            if (data.Result === "true") {
                closeTagOverlay();
                location.reload();
            } else {
                alert('Failed to delete tag');
            }
        })
        .catch(error => {
            showError("Error deleting tag: " + error.message, "Resource Name: " + resourceName);
        });
    }

    function closeTagOverlay() {
        const tagOverlay = document.getElementById('tag-overlay');
        tagOverlay.style.display = 'none';
        document.removeEventListener('click', handleClickOutsideOverlay);
        document.removeEventListener('keydown', handleEscTagOverlay);
    }

    function handleEscTagOverlay(event) {
        if (event.key === "Escape") {
            closeTagOverlay();
        }
    }

    function handleClickOutsideOverlay(event) {
        const tagOverlay = document.getElementById('tag-overlay');
        if (!tagOverlay.contains(event.target)) {
            closeTagOverlay();
        }
    }

    function addVPCTagField() {
        const tagContainer = document.getElementById('vpc-tag-container');
        const tagInput = document.createElement('div');
        tagInput.className = 'vpc-tag-input tag-input-group';
        tagInput.innerHTML = `
            <input type="text" class="vpc-tag-key" placeholder="Key" required>
            <input type="text" class="vpc-tag-value" placeholder="Value" required>
            <button type="button" onclick="removeTagField(this)">-</button>
        `;
        tagContainer.appendChild(tagInput);
    }

    function addSubnetTagField() {
        const tagContainer = document.getElementById('subnet-tag-container');
        const tagInput = document.createElement('div');
        tagInput.className = 'subnet-tag-input tag-input-group';
        tagInput.innerHTML = `
            <input type="text" class="subnet-tag-key" placeholder="Key" required>
            <input type="text" class="subnet-tag-value" placeholder="Value" required>
            <button type="button" onclick="removeTagField(this)">-</button>
        `;
        tagContainer.appendChild(tagInput);
    }

    function removeTagField(button) {
        button.parentElement.remove();
    }

    function addAddSubnetTagField() {
        const tagContainer = document.getElementById('add-subnet-tag-container');
        const tagInput = document.createElement('div');
        tagInput.className = 'add-subnet-tag-input add-tag-input-group';
        tagInput.innerHTML = `
            <input type="text" class="add-subnet-tag-key" placeholder="Key" required>
            <input type="text" class="add-subnet-tag-value" placeholder="Value" required>
            <button type="button" onclick="removeTagField(this)">-</button>
        `;
        tagContainer.appendChild(tagInput);
    }

    function createMultipleVPCs(count) {
        const connConfig = document.getElementById('connConfig').value;
        const region = '{{.RegionName}}';
        const zone = '{{.Zone}}';

        const createPromises = Array.from({ length: count }, () => {
            const vpcName = `${region}-vpc-${Math.random().toString(36).substring(2, 5)}`;
            const vpcCIDR = '10.0.0.0/16';
            const subnetName = `${region}-${zone}-subnet-${Math.random().toString(36).substring(2, 5)}`;
            const subnetCIDR = '10.0.1.0/24';
            const subnetInfo = [{
                Name: subnetName,
                IPv4_CIDR: subnetCIDR,
                Zone: zone,
                TagList: [
                    { Key: 'SubnetTagKey1', Value: 'SubnetTagValue1' },
                    { Key: 'SubnetTagKey2', Value: 'SubnetTagValue2' }
                ]
            }];
            const tags = [
                { Key: 'VPCTagKey1', Value: 'VPCTagValue1' },
                { Key: 'VPCTagKey2', Value: 'VPCTagValue2' }
            ];

            const data = {
                ConnectionName: connConfig,
                ReqInfo: {
                    Name: vpcName,
                    IPv4_CIDR: vpcCIDR,
                    SubnetInfoList: subnetInfo,
                    TagList: tags
                }
            };

            return fetchWithProgress('/spider/vpc', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            }).then(response => {
                if (!response.ok) {
                    return response.json().then(error => {
                        throw new Error(error.message);
                    });
                }
                return response.json();
            });
        });

        Promise.all(createPromises)
            .then(() => {
                location.reload();
            })
            .catch(error => {
                showError("Error creating VPCs: " + error.message, "Multiple VPCs");
            });
    }

    function showAddTagOverlay(vpcName) {
        const addTagOverlay = document.getElementById('add-tag-overlay');
        const addTagOverlayContent = document.querySelector('.add-tag-overlay-content');
        addTagOverlayContent.innerHTML = `
            <div class="tag-overlay-input-group">
                <label for="tagOverlayTagKey">Tag Key:</label>
                <input type="text" id="tagOverlayTagKey" name="tagKey" required>
            </div>
            <div class="tag-overlay-input-group">
                <label for="tagOverlayTagValue">Tag Value:</label>
                <input type="text" id="tagOverlayTagValue" name="tagValue" required>
            </div>
            <div class="tag-overlay-button-group">
                <button onclick="addTag('${vpcName}')">Add</button>
                <button onclick="closeAddTagOverlay()">Cancel</button>
            </div>
        `;
        addTagOverlay.style.display = 'flex';
        document.addEventListener('keydown', handleEscAddTagOverlay);
    }

    function closeAddTagOverlay() {
        const addTagOverlay = document.getElementById('add-tag-overlay');
        addTagOverlay.style.display = 'none';
        document.removeEventListener('keydown', handleEscAddTagOverlay);
    }

    function handleEscAddTagOverlay(event) {
        if (event.key === "Escape") {
            closeAddTagOverlay();
        }
    }

    function addTag(vpcName) {
        const tagKey = document.getElementById('tagOverlayTagKey').value;
        const tagValue = document.getElementById('tagOverlayTagValue').value;
        const connConfig = document.getElementById('connConfig').value;

        const data = {
            ConnectionName: connConfig,
            ReqInfo: {
                ResourceType: 'VPC',
                ResourceName: vpcName,
                Tag: { Key: tagKey, Value: tagValue }
            }
        };

        fetchWithProgress('/spider/tag', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        })
        .then(response => {
            if (!response.ok) {
                return response.json().then(error => {
                    throw new Error(error.message);
                });
            }
            return response.json();
        })
        .then(data => {
            if (data.Key && data.Value) {
                closeAddTagOverlay();
                location.reload();
            } else {
                showError("Failed to add tag: Unknown error", "VPC Name: " + vpcName);
            }
        })
        .catch(error => {
            showError("Error adding tag: " + error.message, "VPC Name: " + vpcName);
        });
    }
    
    document.addEventListener('DOMContentLoaded', () => {
        fetchWithProgress('/spider/connectionconfig/{{.ConnectionConfig}}')
            .then(response => response.json())
            .then(data => {
                currentProvider = data.ProviderName;
                if (currentProvider === 'MOCK') {
                    const mockButtonsContainer = document.getElementById('mockButtonsContainer');

                    const button10 = document.createElement('button');
                    button10.className = 'mock-add-button add-button';
                    button10.textContent = '+10';
                    button10.onclick = () => createMultipleVPCs(10);

                    const button20 = document.createElement('button');
                    button20.className = 'mock-add-button add-button';
                    button20.textContent = '+50';
                    button20.onclick = () => createMultipleVPCs(50);

                    mockButtonsContainer.appendChild(button10);
                    mockButtonsContainer.appendChild(button20);
                }
            })
            .catch(error => {
                console.error('Error fetching provider info:', error);
            });
    });

    function showAddSubnetTagOverlay(vpcName, subnetName) {
        const addTagOverlay = document.getElementById('add-subnet-tag-overlay');
        const addTagOverlayContent = document.querySelector('.add-subnet-tag-overlay-content');
        addTagOverlayContent.innerHTML = `
            <div class="tag-overlay-input-group">
                <label for="subnetOverlayTagKey">Tag Key:</label>
                <input type="text" id="subnetOverlayTagKey" name="subnetTagKey" required>
            </div>
            <div class="tag-overlay-input-group">
                <label for="subnetOverlayTagValue">Tag Value:</label>
                <input type="text" id="subnetOverlayTagValue" name="subnetTagValue" required>
            </div>
            <div class="tag-overlay-button-group">
                <button onclick="addSubnetTag('${vpcName}', '${subnetName}')">Add</button>
                <button onclick="closeAddSubnetTagOverlay()">Cancel</button>
            </div>
        `;
        addTagOverlay.style.display = 'flex';
        document.addEventListener('keydown', handleEscAddSubnetTagOverlay);
    }


    function closeAddSubnetTagOverlay() {
        const addTagOverlay = document.getElementById('add-subnet-tag-overlay');
        addTagOverlay.style.display = 'none';
        document.removeEventListener('keydown', handleEscAddSubnetTagOverlay);
    }

    function handleEscAddSubnetTagOverlay(event) {
        if (event.key === "Escape") {
            closeAddSubnetTagOverlay();
        }
    }

    function addSubnetTag(vpcName, subnetName) {
        const tagKey = document.getElementById('subnetOverlayTagKey').value;
        const tagValue = document.getElementById('subnetOverlayTagValue').value;
        const connConfig = document.getElementById('connConfig').value;

        const data = {
            ConnectionName: connConfig,
            ReqInfo: {
                ResourceType: 'SUBNET',
                ResourceName: subnetName,
                Tag: { Key: tagKey, Value: tagValue }
            }
        };

        fetchWithProgress('/spider/tag', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        })
        .then(response => {
            if (!response.ok) {
                return response.json().then(error => {
                    throw new Error(error.message);
                });
            }
            return response.json();
        })
        .then(data => {
            if (data.Key && data.Value) {
                closeAddSubnetTagOverlay();
                location.reload();
            } else {
                showError("Failed to add tag: Unknown error", "Subnet Name: " + subnetName);
            }
        })
        .catch(error => {
            showError("Error adding tag: " + error.message, "Subnet Name: " + subnetName);
        });
    }

    function searchKeyword() {
        let input, filter, table, tr, td, i, j, k, innerTable, innerTr, innerTd, txtValue;
        input = document.getElementById('searchInput');
        filter = input.value.toUpperCase().trim(); 
        if (!filter) {
            clearSearchInput();
            return;
        }

        table = document.getElementById('vpc-table');
        tr = table.getElementsByTagName('tr');
        
        for (i = 1; i < tr.length; i++) {
            for (j = 0; j < tr[i].cells.length; j++) {
                td = tr[i].cells[j];
                if (td) {
                    txtValue = td.textContent || td.innerText;
                    if (td.querySelector('table.inner-table')) {
                        innerTable = td.querySelector('table.inner-table');
                        innerTr = innerTable.getElementsByTagName('tr');
                        for (k = 1; k < innerTr.length; k++) {
                            for (let l = 0; l < innerTr[k].cells.length; l++) {
                                innerTd = innerTr[k].cells[l];
                                txtValue = innerTd.textContent || innerTd.innerText;
                                if (txtValue.toUpperCase().indexOf(filter) > -1) {
                                    innerTd.classList.add('highlight');
                                } else {
                                    innerTd.classList.remove('highlight');
                                }
                            }
                        }
                    } else {
                        if (txtValue.toUpperCase().indexOf(filter) > -1) {
                            td.classList.add('highlight');
                        } else {
                            td.classList.remove('highlight');
                        }
                    }
                }
            }
        }
    }

    function clearSearchInput() {
        document.getElementById("searchInput").value = "";
        let table = document.getElementById('vpc-table');
        let tr = table.getElementsByTagName('tr');
        for (let i = 1; i < tr.length; i++) {
            for (let j = 0; j < tr[i].cells.length; j++) {
                tr[i].cells[j].classList.remove('highlight');
                if (tr[i].cells[j].querySelector('table.inner-table')) {
                    let innerTable = tr[i].cells[j].querySelector('table.inner-table');
                    let innerTr = innerTable.getElementsByTagName('tr');
                    for (let k = 1; k < innerTr.length; k++) {
                        for (let l = 0; l < innerTr[k].cells.length; l++) {
                            innerTr[k].cells[l].classList.remove('highlight');
                        }
                    }
                }
            }
        }
    }

    function fetchWithProgress(url, options) {
        showProgressBar();
        
        const startTime = Date.now();
        const timerInterval = 500; 
        let timerId = setInterval(() => {
            const elapsedTime = (Date.now() - startTime) / 1000;
            const timeDisplay = document.getElementById('timeDisplay');
            timeDisplay.textContent = `${(Math.floor(elapsedTime * 2) / 2).toFixed(1)}s`;
        }, timerInterval);

        return fetch(url, options)
            .then(response => {
                clearInterval(timerId); 
                hideProgressBar();
                return response;
            })
            .catch(error => {
                clearInterval(timerId);
                hideProgressBar();
                throw error;
            });
    }

    function showProgressBar() {
        const progressBarContainer = document.getElementById('progressBarContainer');
        const progressBar = document.getElementById('progressBar');
        progressBar.style.width = '0%';
        progressBarContainer.style.display = 'block';

        setTimeout(() => {
            progressBar.style.width = '100%';
        }, 100);
    }

    function hideProgressBar() {
        const progressBarContainer = document.getElementById('progressBarContainer');
        setTimeout(() => {
            progressBarContainer.style.display = 'none';
            document.getElementById('timeDisplay').textContent = ''; 
        }, 500);
    }
        
    function showMiscOverlay(button) {
        const miscContent = button.previousElementSibling.innerHTML;

        const overlayDarkBackground = document.createElement('div');
        overlayDarkBackground.className = 'overlay-dark-background';
        document.body.appendChild(overlayDarkBackground);

        const overlay = document.createElement('div');
        overlay.className = 'misc-overlay';
        overlay.innerHTML = `
            <button class="close-btn">x</button>
            <div class="misc-overlay-content" tabindex="0">${miscContent}</div>
        `;

        document.body.appendChild(overlay);
        overlayDarkBackground.style.display = 'block';
        overlay.style.display = 'block';

        const overlayContent = overlay.querySelector('.misc-overlay-content');
        overlayContent.focus();

        document.addEventListener('keydown', handleEscKey);
        overlayDarkBackground.addEventListener('click', handleClickOutside);
        overlay.querySelector('.close-btn').addEventListener('click', closeMiscOverlay);

        function closeMiscOverlay() {
            if (overlay) overlay.remove();
            if (overlayDarkBackground) overlayDarkBackground.remove();
            document.removeEventListener('keydown', handleEscKey);
            overlayDarkBackground.removeEventListener('click', handleClickOutside);
        }

        function handleEscKey(event) {
            if (event.key === 'Escape') {
                closeMiscOverlay();
            }
        }

        function handleClickOutside(event) {
            if (event.target === overlayDarkBackground) {
                closeMiscOverlay();
            }
        }
    }

    document.addEventListener('DOMContentLoaded', () => {
        const miscCells = document.querySelectorAll('.misc-cell');

        miscCells.forEach(cell => {
            const content = cell.querySelector('.misc-content');
            const button = cell.querySelector('.more-btn');

            if (content.scrollHeight > content.clientHeight) {
                button.style.display = 'inline-block';
            } else {
                button.style.display = 'none';
            }
        });
    });


    function showSystemIdOverlay(systemId) {
        const overlay = document.getElementById('system-id-overlay');
        const fullSystemIdElement = document.getElementById('fullSystemId');
        fullSystemIdElement.textContent = systemId;

        overlay.style.display = 'block';
        document.addEventListener('keydown', handleEscSystemIdOverlay);
    }

    function closeSystemIdOverlay() {
        const overlay = document.getElementById('system-id-overlay');
        overlay.style.display = 'none';
        document.removeEventListener('keydown', handleEscSystemIdOverlay);
    }

    function handleEscSystemIdOverlay(event) {
        if (event.key === "Escape") {
            closeSystemIdOverlay();
        }
    }

    function copySystemId() {
        const fullSystemIdElement = document.getElementById('fullSystemId');
        const range = document.createRange();
        range.selectNode(fullSystemIdElement);
        const selection = window.getSelection();

        selection.removeAllRanges();
        selection.addRange(range);

        try {
            document.execCommand('copy');
            closeSystemIdOverlay();
        } catch (err) {
            console.error('Error copying SystemId: ', err);
        }

        selection.removeAllRanges();
    }

    // Disable VPC CIDR Input in GCP
    function disableGCPCIDR(connConfig){
        const vpcCIDRInput = document.getElementById('vpcCIDR');
        if (currentProvider == 'GCP') {
            vpcCIDRInput.disabled = true;
            vpcCIDRInput.value = 'NA';
            vpcCIDRInput.style.color = 'gray';
            vpcCIDRInput.style.backgroundColor = '#f0f0f0';
        }
    }

    function fetchZone(zoneSelect){
        const regionId = '{{.Region}}';
        const defaultZone = '{{.Zone}}';
        const connConfig = document.getElementById('connConfig').value;

        fetch(`/spider/regionzone/${regionId}?ConnectionName=${connConfig}`)
            .then(response => response.json())
            .then(data => {
                zoneSelect.innerHTML = '';
                data.ZoneList.forEach(zone => {
                    const option = document.createElement('option');
                    option.value = zone.Name;
                    option.textContent = `${zone.Name} (${zone.DisplayName})`;

                    if (zone.Name === defaultZone) {
                        option.selected = true;
                    }

                    zoneSelect.appendChild(option);
                });
            })
            .catch(error => {
                console.error('Error fetching Zone List:', error);
                alert('Failed to load Zone list.');
            });
    }
           

</script>
</html>
